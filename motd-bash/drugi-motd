#!/bin/bash

# jak juz wiadomo kolorki sa super
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
PURPLE='\033[1;35m'
CYAN='\033[1;36m'
NC='\033[0m'

# pasek
draw_bar() {
    local perc=$1
    local size=20
    local filled=$(( perc * size / 100 ))
    local empty=$(( size - filled ))
    printf "["
    printf "${GREEN}%0.s#${NC}" $(seq 1 $filled)
    printf "%0.s-" $(seq 1 $empty)
    printf "] %d%%" "$perc"
}

clear
echo -e "${BLUE}┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓${NC}"
toilet -f small -F metal "                  $(hostname)"
echo ""
echo -e "${BLUE}┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛${NC}"

# podstawowe informacje o systemie
UPTIME=${PURPLE}$(uptime -p | sed 's/up //')
LOAD=${PURPLE}$(cat /proc/loadavg | awk '{print $1}')
IP_LOC=${PURPLE}$(hostname -I | awk '{print $1}')

echo ""
echo -e " ${CYAN}System:${PURPLE}          $(lsb_release -d | cut -f2)"
echo -e " ${CYAN}Czas działania:${NC}  $UPTIME"
echo -e " ${CYAN}IP:${NC}              $IP_LOC"
echo -e "\n${BLUE}── RAM ────────────────────────────────────────────────────${NC}"

# RAM
MEM_USED=$(free | awk '/^Mem/ {print $3}')
MEM_TOTAL=$(free | awk '/^Mem/ {print $2}')
MEM_PERC=$(( MEM_USED * 100 / MEM_TOTAL ))
echo ""
printf " ${GREEN}RAM:${NC}  %-15s "
draw_bar $MEM_PERC
echo -e " ($(free -h | awk '/^Mem/ {print $3 "/" $2}'))"

# SWAP - dodano obliczenia i wyświetlanie
SWAP_TOTAL=$(free | awk '/^Swap/ {print $2}')
if [ "$SWAP_TOTAL" -gt 0 ]; then
    SWAP_USED=$(free | awk '/^Swap/ {print $3}')
    SWAP_PERC=$(( SWAP_USED * 100 / SWAP_TOTAL ))
    printf " ${GREEN}SWAP:${NC} %-15s "
    draw_bar $SWAP_PERC
    echo -e " ($(free -h | awk '/^Swap/ {print $3 "/" $2}'))"
else
    echo -e " ${GREEN}SWAP:${NC} %-15s ${RED}Brak pliku SWAP!${NC}"
fi

# Punkty montowania
MY_DISKS=( "/" "/dysk2" "/dysk3" )

echo -e "\n${BLUE}── Dyski ─────────────────────────────────────────────────────${NC}"

echo ""

for MOUNT in "${MY_DISKS[@]}"; do
    if [ -d "$MOUNT" ]; then
        INFO=$(df -h "$MOUNT" | tail -n 1)
        PERC=$(echo "$INFO" | awk '{print $(NF-1)}' | sed 's/%//')
        FREE=$(echo "$INFO" | awk '{print $(NF-2)}')

        # Skracanie ścieżki
        DISPLAY_NAME=$(echo "$MOUNT" | sed "s|$HOME|~|")

        printf " ${GREEN}Dysk:${NC} %-15s " "$DISPLAY_NAME"
        draw_bar "$PERC"
        echo -e " ($FREE wolne)"
    fi
done

# spawdzanie ile kontenerow dziala i ile jest wszytkich
if command -v docker >/dev/null 2>&1; then
    echo -e "\n${BLUE}── Kontenery ─────────────────────────────────────────────────${NC}"
    echo ""
    D_RUNNING=$(docker ps -q | wc -l)
    D_TOTAL=$(docker ps -a -q | wc -l)
    echo -e " ${PURPLE}Docker:${NC}   $D_RUNNING aktywnych / $D_TOTAL wszystkich"
    echo ""
fi
